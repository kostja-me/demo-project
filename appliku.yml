build_settings:
  build_image: python-3.13-node-20.18
  build_command: npm i && npm run tailwind:build
  environment_variables:
    - name: APPLIKU
      value: "true"
    - name: DATABASE_URL
      from_database:
        name: db
        property: connection_url
    - name: REDIS_URL
      from_database:
        name: redis
        property: private_connection_url

services:
  web:
    command: bash web.sh
  worker:
    command: bash celery-worker.sh
  beat:
    command: bash celery-beat.sh
  release:
    command: bash release.sh

databases:
  db:
    type: postgresql_17
  db2:
    type: postgresql_17
  redis:
    type: redis_7
  db444:
    type: postgresql_17

cronjobs:
  send_emails:
    schedule: "0 * * * *"
    command: python manage.py send_emails
  fetch_rss2:
    schedule: "*/10 * * * *"
    command: python manage.py fetch_rss_feeds

volumes:
  data:
    target: /data/
  media:
    target: /media/
    url: /media/
    environment_variable: MEDIA
